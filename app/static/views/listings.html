<h1> Contracts </h1>
<dl class='business-list' ng-repeat='business in vm.businesses'>
    <dt>
        <h2> {{ business.name }} </h2>
        <p>
        {{ vm.util.formatAddress(business.fixed_location) }}
        </p>
        <p ng-if='business.positions.length === 0'>
        This business currently has no positions.
        </p>
        <div class='new-listing-positions-list'>
            <a class='button block call-to-action' ng-repeat='position in business.positions'
                    ui-sref='new-listing({businessId: business.id, positionId: position.id})'>
                Get a {{ position.name }}
            </a>
            <a class='button block call-to-action'
                    ui-sref='new-position({businessId: business.id})'>
                New position
            </a>
        </div>
    </dt>
    <dd>
        <p ng-if='business.listings.length === 0'>
        This location has no contracts yet.
        </p>
        <dl ng-if='business.listings.length > 0'
                class='listings-list'>
            <div class='item' ng-repeat='listing in business.listings'>
                <dt>
                    <div class='listing-header'>
                        <div>
                            <h3> {{ listing.position.name }} </h3>
                            <div class='listing-create-time'>
                                Created
                                on {{ vm.util.formatDate(listing.create_date) }}
                                at {{ vm.util.formatTime(listing.create_date) }}
                            </div>
                        </div>
                        <div>
                            <div>
                                <button ng-click='listing.delete()'>
                                    Delete
                                </button>
                                <a class='button'
                                        ui-sref='edit-listing({businessId: business.id, listingId: listing.id})'>
                                    Edit
                                </a>
                            </div>
                            <p class='listing-pay'> {{ listing.pay }}$/h </p>
                            <p class='listing-status'> {{ listing.status.friendly_name }} </p>
                        </div>
                    </div>
                </dt>
                <dd>
                    <div> {{ listing.details }} </div>

                    <div class='contractor-info'>
                        <div ng-if='listing.employee'>
                            <h4> Contractor - {{ listing.employee.human.first_name }} {{ listing.employee.human.last_name }}</h4>
                            <ul class='flat'>
                                <li><i class='fa fa-phone'></i> {{ listing.employee.human.contact_info.phone_number }} </li>
                            </ul>
                        </div>
                        <div ng-if='!listing.employee'>
                            <strong>No contractor is assigned yet.</strong>
                            <div ng-if='listing.applicants'>
                                <h4> Applicants </h4>
                                <ul class='flat'>
                                    <li class='listing-applicant' 
                                            ng-repeat='applicant in listing.applicants'>
                                        <div class='listing-header'>
                                            <div>
                                                <h5> {{ applicant.human.first_name }} {{ applicant.human.last_name }} </h5>
                                            </div>
                                            <div>
                                                <button ng-click='vm.approveApplicant(listing, applicant)'>
                                                    Approve
                                                </button>
                                            </div>
                                        </div>
                                        <ul class='flat'>
                                            <li<i class='fa fa-phone'></i> {{ applicant.human.contact_info.phone_number }} </li>
                                        </ul>
                                    </li>
                                </div>
                            </div>
                            <div ng-if='!listing.applicants'>
                                <strong>No one has applied yet.</strong>
                            </div>
                        </div>
                    </div>
                </dd>
            </div>
        </dl>
    </dd>
</dl>
